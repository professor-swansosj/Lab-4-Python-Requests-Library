# Instructions â€” Lab 4 â€” Python Requests Library

## Objectives
- Use the Python `requests` library to call public APIs.
- Handle headers, status codes, and JSON parsing robustly.
- Build a small CLI utility that prints a specific JSON field (Dad Jokes).
- Implement a dynamic, multi-player 'highest card' game with Deck of Cards.
- Log meaningful events for autograding and troubleshooting.
- Write artifacts (raw JSON, human-readable summaries) to the repo.

## Prerequisites
- Python 3.11 (via the provided dev container)
- Accounts: GitHub
- Devices/Sandboxes: Public APIs (Dad Jokes, Deck of Cards)
- Technical: - Intermediate Python: functions, loops, conditionals, f-strings.
- Basic error handling with try/except and the logging module.
- Comfort reading API docs and inspecting JSON structures.
- GitHub Classroom workflow (clone, commit, push, PR).
- Prior Lab 3 experience with cURL/jq or equivalent.

## Overview
Youâ€™ll author two Python programs using the `requests` library. First, a simple script that fetches a single Dad Joke and prints only the joke text to stdout (and optionally saves it to a file). Second, youâ€™ll build a dynamic 'highest card wins' game powered by the Deck of Cards API: any number of players draw one card, the highest rank wins; ties re-draw among tied players until a single winner emerges. Youâ€™ll log markers to `logs/lab4.log` for autograding and save artifacts under `data/`.


> **Before you begin:** Open the dev container (or ensure Python 3.11 + `requests` is installed). Verify `import requests` works, and that you can write to `data/` and `logs/`.


## Resources
- [Requests (Python)](https://requests.readthedocs.io/en/latest/)- [Dad Jokes API](https://icanhazdadjoke.com/api)- [Deck of Cards API](https://deckofcardsapi.com/)- [pprint (Python)](https://docs.python.org/3/library/pprint.html)- [logging (Python)](https://docs.python.org/3/library/logging.html)
## Deliverables
- `src/tell_me_a_joke.py` prints only the joke line to stdout and logs success.
- `src/high_card.py` implements the dynamic highest-card game with tie-breaker rounds.
- `logs/lab4.log` contains required autograder markers from both scripts.
- `data/joke.json` and `data/joke.txt` generated by the joke script.
- `data/high_card_rounds.json` (optional but recommended) and `data/high_card_result.txt` from the game.
- Pull request open to main branch with all artifacts.
- Grading: **75 points**

Follow these steps in order.

> **Logging Requirement:** Write progress to `logs/lab4.log` as you complete each step.

## Step 1 â€” Clone the Repository
**Goal:** Get your starter locally.

**What to do:**  
Clone your Classroom repo and `cd` into it. Create `src/`, `data/`, and `logs/` if missing.
Initialize the log: `echo 'LAB4_START' >> logs/lab4.log`


**You're done when:**  
- Repo folders exist.
- `LAB4_START` present in `logs/lab4.log`.


**Log marker to add:**  
`[LAB4_START]`

## Step 2 â€” Open Dev Container
**Goal:** Standardize environment.

**What to do:**  
Reopen in container and verify:
  - `python --version` shows 3.11+
  - `python -c "import requests; print('OK')"` prints OK
Append `[STEP 2] Dev Container Started` to `logs/lab4.log`.


**You're done when:**  
- Python 3.11+ confirmed, requests import OK.
- Log includes `[STEP 2] Dev Container Started`.


**Log marker to add:**  
`[[STEP 2] Dev Container Started]`

## Step 3 â€” Script 1 â€” tell_me_a_joke.py
**Goal:** Fetch a joke and print only the joke text.

**What to do:**  
Create `src/tell_me_a_joke.py` that:
  - Uses `requests.get('https://icanhazdadjoke.com/', headers={'Accept':'application/json'}, timeout=10)`
  - Checks `response.status_code == 200`; log `LAB4_JOKE_HTTP_OK` or `LAB4_ERR` on failure.
  - Parses JSON, extracts `.get('joke')`, prints ONLY the joke line to stdout (no extra text).
  - Saves full JSON to `data/joke.json` and the joke line to `data/joke.txt`.
  - Logs `LAB4_JOKE_JSON_OK` and `LAB4_JOKE_PRINTED` on success.


**You're done when:**  
- `data/joke.json` and `data/joke.txt` exist and are non-empty.
- Terminal output shows only the joke line.
- Log contains `LAB4_JOKE_HTTP_OK`, `LAB4_JOKE_JSON_OK`, `LAB4_JOKE_PRINTED`.


**Log marker to add:**  
`[LAB4_JOKE_HTTP_OK, LAB4_JOKE_JSON_OK, LAB4_JOKE_PRINTED]`

## Step 4 â€” Script 2 â€” high_card.py
**Goal:** Dynamic, multi-player 'highest card' with tie-breakers.

**What to do:**  
Create `src/high_card.py` that:
  - Creates a new shuffled deck: GET `/api/deck/new/shuffle/?deck_count=1`
    * Capture `deck_id`; log `LAB4_DECK_CREATE_OK`.
  - Prompts for number of players (>=2). Validate input; re-prompt or exit with `LAB4_ERR` if invalid.
  - Draws one card per player: GET `/api/deck/{deck_id}/draw/?count=<players>`
    * Map ranks {2..10,J,Q,K,A} -> {2..14}. Store player->card->value.
    * Log `LAB4_DRAW_OK` and save raw JSON to `data/high_card_rounds.json` (append or structure per round).
  - Determines the highest value; if tie among N players, re-draw **only for tied players**:
    * Repeat draw until exactly one winner remains.
    * For each tie round, log `LAB4_TIE_ROUND` and append round data.
  - Prints a clear summary of each round and the **final winner**.
    * Save a final summary to `data/high_card_result.txt`; log `LAB4_GAME_END`.
  - Handles and logs network errors (`requests.Timeout`, `requests.RequestException`) as `LAB4_ERR`.


**You're done when:**  
- Deck created; draw(s) executed with rank mapping and tie-breakers if needed.
- `data/high_card_result.txt` describes the winner and shows at least one round.
- Log contains `LAB4_DECK_CREATE_OK`, `LAB4_DRAW_OK`, optional `LAB4_TIE_ROUND` (if tie), and `LAB4_GAME_END`.


**Log marker to add:**  
`[LAB4_DECK_CREATE_OK, LAB4_DRAW_OK, LAB4_TIE_ROUND, LAB4_GAME_END]`

## Step 5 â€” Finalize and Submit
**Goal:** Push artifacts and open PR.

**What to do:**  
Ensure the script(s) add `LAB4_END` to `logs/lab4.log` at completion (or echo it before commit).
Commit and push all changes. Open a pull request targeting `main`.


**You're done when:**  
- PR is open; artifacts present under `src/`, `data/`, and `logs/`.
- `LAB4_END` recorded in `logs/lab4.log`.


**Log marker to add:**  
`[LAB4_END]`


## FAQ
**Q:** Dad Jokes returned HTML instead of JSON.  
**A:** Add `headers={'Accept':'application/json'}` to the request.

**Q:** Iâ€™m getting timeouts.  
**A:** Set `timeout=10` on requests and catch `requests.Timeout` to log `LAB4_ERR` gracefully.

**Q:** Face cards compare weirdly.  
**A:** Normalize ranks once: map J=11, Q=12, K=13, A=14, then compare integers.


## ðŸ”§ Troubleshooting & Pro Tips
**Keep logs deterministic**  
*Symptom:* Autograder canâ€™t find markers.  
*Fix:* Log exact tokens provided and write `logging.basicConfig(filename='logs/lab4.log', level=logging.INFO)` once.

**Donâ€™t print extra text in joke script**  
*Symptom:* Joke line buried in other output.  
*Fix:* The grader expects just the joke text on stdout; put explanations in the log or a file.

**Tie-breaker loop safety**  
*Symptom:* Infinite loop on repeated ties.  
*Fix:* Limit tie rounds (e.g., 10) and fail gracefully with `LAB4_ERR` if exceeded.


## Grading Breakdown
| Step | Requirement | Points |
|---|---|---|
| Step 2 | Dev container started; requests available | 5 |
| Script 1 | HTTP OK with Accept header (`LAB4_JOKE_HTTP_OK`) | 5 |
| Script 1 | JSON parsed; joke extracted (`LAB4_JOKE_JSON_OK`) | 5 |
| Script 1 | Printed-only joke + saved artifacts (`LAB4_JOKE_PRINTED`) | 5 |
| Script 2 | Deck created; deck_id captured (`LAB4_DECK_CREATE_OK`) | 5 |
| Script 2 | Validated dynamic player input; initial draw OK (`LAB4_DRAW_OK`) | 10 |
| Script 2 | Rank mapping + round winner logic; tie-breakers (`LAB4_TIE_ROUND` if applicable) | 10 |
| Script 2 | Final winner summary saved (`LAB4_GAME_END` + result file) | 10 |
| Script 2 | Handled at least one error path and logged `LAB4_ERR` | 5 |
| Submission | PR open; all markers present in `logs/lab4.log` | 15 |
| **Total** |  | **75** |

## Autograder Notes
- Log file: `logs/lab4.log`
- Required markers: `LAB4_START`, `[STEP 2] Dev Container Started`, `LAB4_JOKE_HTTP_OK`, `LAB4_JOKE_JSON_OK`, `LAB4_JOKE_PRINTED`, `LAB4_DECK_CREATE_OK`, `LAB4_DRAW_OK`, `LAB4_TIE_ROUND`, `LAB4_GAME_END`, `LAB4_END`

## Submission Checklist
- [ ] `src/tell_me_a_joke.py` prints only the joke, no extra text.
- [ ] `src/high_card.py` supports dynamic players and tie-breakers.
- [ ] Artifacts exist: `data/joke.json`, `data/joke.txt`, and `data/high_card_result.txt` (+ optional rounds JSON).
- [ ] `logs/lab4.log` contains all required markers for both scripts.
- [ ] Pull request open to `main` before deadline.
